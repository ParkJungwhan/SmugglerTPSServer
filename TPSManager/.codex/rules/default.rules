prefix_rule(pattern=["C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe", "-Command", "git fetch --all --prune"], decision="allow")
prefix_rule(pattern=["C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe", "-Command", ".specify/scripts/powershell/create-new-feature.ps1 -Json -Number 1 -ShortName \"udp-flatbuffer-commands\" \"블레이저 웹을 통해서 UDP 서버와 Flatbuffer로 통신하여 패킷을 통해 커맨드 전송이 되는 구성을 만들어야한다. 패킷은 C:RepoSmugglerTPSServerSmugglerLibGeneratedProtocol에 이미 구성되어 있다. 패킷 추가는 개발자가 할 예정. flatbuffer를 통해 c++ udp 서버와 통신이 되면 된다. 이후 DB는 postgrsql과 통신할것이다. 그래서 dapper를 통한 통신이 진행될것\""], decision="allow")
prefix_rule(pattern=["C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe", "-Command", "@'\n# Feature Specification: Blazor UDP Flatbuffer Command Bridge\n\n**Feature Branch**: `001-udp-flatbuffer-commands`  \n**Created**: 2025-12-16  \n**Status**: Draft  \n**Input**: User description: \"블레이저 웹을 통해서 UDP 서버와 Flatbuffer로 통신하여 패킷을 통해 커맨드 전송이 되는 구성을 만들어야한다. 패킷은 C:RepoSmugglerTPSServerSmugglerLibGeneratedProtocol에 이미 구성되어 있다. 패킷 추가는 개발자가 할 예정. flatbuffer를 통해 c++ udp 서버와 통신이 되면 된다. 이후 DB는 postgrsql과 통신할것이다. 그래서 dapper를 통한 통신이 진행될것\"\n\n## User Scenarios & Testing *(mandatory)*\n\n### User Story 1 - 운영자가 UDP 명령 전송 (Priority: P1)\n\n운영자는 Blazor 웹 도구에서 기존 Flatbuffer 패킷 정의를 선택해 UDP 서버로 명령을 전송한다.\n\n**Why this priority**: 핵심 기능으로, 관리 명령 송신이 가능해야 다른 기능이 의미를 갖는다.\n\n**Independent Test**: 웹 UI에서 패킷 선택/입력 후 전송 시 서버 응답을 받으면 완료 상태로 표시되는지 확인한다.\n\n**Acceptance Scenarios**:\n\n1. **Given** 운영자가 인증된 상태로 명령 유형과 파라미터를 선택하고, **When** 전송을 요청하면, **Then** Flatbuffer 형식으로 패킷이 조립되어 UDP 서버로 전송된다.\n2. **Given** 서버가 응답 패킷을 반환할 때, **When** 웹 도구가 응답을 수신하면, **Then** 성공 여부와 서버 메시지를 UI에 표시한다.\n\n---\n\n### User Story 2 - 전송 상태 가시화 및 재시도 (Priority: P2)\n\n운영자는 패킷 전송 결과(성공/타임아웃/실패)와 재시도 옵션을 확인할 수 있다.\n\n**Why this priority**: UDP 특성상 손실 가능성이 있어 운영자가 즉시 상태를 파악하고 조치해야 한다.\n\n**Independent Test**: 서버 응답 지연/손실을 시뮬레이션하여 UI가 타임아웃을 표시하고 재시도 동작을 수행하는지 확인한다.\n\n**Acceptance Scenarios**:\n\n1. **Given** 서버 응답이 없을 때, **When** 타임아웃이 발생하면, **Then** UI가 실패 사유를 표시하고 재시도 버튼을 제공한다.\n2. **Given** 재시도를 수행할 때, **When** 서버가 성공 응답을 반환하면, **Then** 최종 성공 상태로 업데이트하고 이력을 남긴다.\n\n---\n\n### User Story 3 - 명령/응답 이력 기록 (Priority: P3)\n\n운영자는 명령 전송·응답 이력이 DB에 저장되어 이후 감사/분석에 활용할 수 있다.\n\n**Why this priority**: 운영 추적성과 회귀 분석을 위해 이력이 필요하다.\n\n**Independent Test**: 명령 전송 후 DB에서 해당 요청/응답 기록이 생성되고, UI나 보고서에서 조회 가능함을 확인한다.\n\n**Acceptance Scenarios**:\n\n1. **Given** 명령이 성공/실패로 종료되었을 때, **When** 기록 작업이 수행되면, **Then** 요청자, 명령 유형, 파라미터, 응답 코드/메시지, 타임스탬프가 DB에 저장된다.\n2. **Given** 저장된 이력이 있을 때, **When** 운영자가 검색 조건으로 조회하면, **Then** 해당 결과가 정렬·필터링되어 표시된다.\n\n---\n\n### Edge Cases\n\n- UDP 패킷 손실/지연으로 응답이 없는 경우 타임아웃 및 재시도 처리.\n- Flatbuffer 스키마 버전 불일치나 알 수 없는 패킷 유형을 수신할 때 오류 표시 및 로깅.\n- DB 연결 실패 시 전송 자체는 지속하되, 이력 적재 실패를 사용자에게 알리고 재시도 경로를 제공.\n- 동일 명령 반복 전송 시 중복 처리(서버 idempotency 여부)에 따라 재전송 정책을 명시적으로 안내.\n\n## Requirements *(mandatory)*\n\n### Functional Requirements\n\n- **FR-001**: 시스템은 기존 `SmugglerLib/Generated/Protocol`에 정의된 Flatbuffer 패킷 스키마를 사용해 UI 입력을 검증·조립하여 UDP 전송에 적합한 바이트 페이로드를 생성해야 한다.\n- **FR-002**: 시스템은 구성된 UDP 엔드포인트로 패킷을 전송하고, 응답 수신 시 성공/실패 코드와 메시지를 UI에 표준화된 상태로 반영해야 한다.\n- **FR-003**: 시스템은 응답이 없을 때 p95 기준 [2]초 이내에 타임아웃을 표시하고, 최소 한 번 이상의 재시도 옵션을 제공해야 한다.\n- **FR-004**: 시스템은 전송/응답 상태를 실시간으로 표시하며, 운영자가 재시도·중단을 선택할 수 있는 UI를 제공해야 한다.\n- **FR-005**: 시스템은 모든 전송 요청에 대해 고유 식별자, 사용자, 명령 유형, 파라미터, 전송 시각, 응답 시각/결과를 기록하고 조회·필터링 기능을 제공해야 한다.\n- **FR-006**: 시스템은 DB 연결 정보, UDP 대상 주소/포트, Flatbuffer 스키마 버전을 환경 설정으로 받아들이며, 설정 변경 시 앱 재시작 없이 반영 여부를 명확히 안내해야 한다.\n- **FR-007**: 시스템은 인증된 운영자만 명령을 전송·조회할 수 있도록 기존 권한 모델을 적용하고, 모든 실패/예외를 로깅해야 한다.\n- **FR-008**: 시스템은 스키마 업데이트(새 패킷 추가 등) 시 최신 스키마를 불러와 UI 선택지와 검증 로직을 일관되게 반영해야 한다.\n\n### Key Entities *(include if feature involves data)*\n\n- **CommandPacket**: 전송할 명령 유형과 파라미터를 캡슐화한 구조(Flatbuffer 정의 기반).\n- **CommandDispatch**: 전송 요청 메타데이터(요청자, 목적지, 시각, 상태, 재시도 횟수).\n- **CommandResult**: 응답 코드/메시지, 수신 시각, 오류 정보, 연계된 Dispatch 식별자.\n\n## 품질 기준 *(mandatory)*\n\n- **Testing**: 단위(패킷 조립/검증), 통합(UDP 송수신 시나리오), 계약(Flatbuffer 스키마 호환) 테스트를 작성하고 `dotnet test`가 재현 가능하게 통과해야 한다.\n- **Performance**: 운영자가 전송 버튼을 누른 후 95% 요청이 2초 이내 상태 업데이트를 보며, 50rps 동시 요청에서도 지연 목표를 유지한다는 계획과 측정 방법을 명시한다.\n- **Security**: 비밀·엔드포인트는 환경 설정으로 관리하고, 입력 검증·권한 확인을 거쳐서만 전송한다. 모든 에러·거부 이벤트는 감사 로그에 남긴다.\n- **Documentation**: 스펙/플랜/태스크와 운영 로그에 전송 흐름, 재시도/타임아웃 정책, 의존 스키마 버전, 설정 방법을 동일 릴리스에 기록한다.\n- **Quality Bar**: SmugglerLib 스키마와 동기화 상태를 유지하고, 린트/정적 분석 경고 없이 빌드되며, 리뷰 시 테스트/성능/보안 영향 요약을 포함한다.\n\n## Success Criteria *(mandatory)*\n\n### Measurable Outcomes\n\n- **SC-001**: 운영자가 정의된 명령을 전송했을 때 95% 이상에서 2초 이내에 성공/실패 상태가 UI에 표시된다.\n- **SC-002**: UDP 응답 손실 상황에서 최소 1회 재시도 후 90% 이상이 성공 상태로 전환된다(서버 가용 시 기준).\n- **SC-003**: 모든 전송 건에 대해 요청자, 명령 유형, 결과가 DB 조회에서 100% 확인 가능하다.\n- **SC-004**: 사용자 만족도 조사 또는 피드백에서 “명령 전송 흐름이 명확하다” 항목에 80% 이상 긍정 응답을 얻는다.\n'@ | Set-Content -Path C:\\Repo\\SmugglerTPSServer\\specs\\001-udp-flatbuffer-commands\\spec.md"], decision="allow")
prefix_rule(pattern=["C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe", "-Command", "New-Item -ItemType Directory -Path C:\\Repo\\SmugglerTPSServer\\specs\\001-udp-flatbuffer-commands\\checklists -Force | Out-Null"], decision="allow")
prefix_rule(pattern=["C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe", "-Command", "@'\n# Specification Quality Checklist: Blazor UDP Flatbuffer Command Bridge\n\n**Purpose**: Validate specification completeness and quality before proceeding to planning\n**Created**: 2025-12-16\n**Feature**: spec.md\n\n## Content Quality\n\n- [x] No implementation details (languages, frameworks, APIs)\n- [x] Focused on user value and business needs\n- [x] Written for non-technical stakeholders\n- [x] All mandatory sections completed\n\n## Requirement Completeness\n\n- [x] No [NEEDS CLARIFICATION] markers remain\n- [x] Requirements are testable and unambiguous\n- [x] Success criteria are measurable\n- [x] Success criteria are technology-agnostic (no implementation details)\n- [x] All acceptance scenarios are defined\n- [x] Edge cases are identified\n- [x] Scope is clearly bounded\n- [x] Dependencies and assumptions identified\n\n## Feature Readiness\n\n- [x] All functional requirements have clear acceptance criteria\n- [x] User scenarios cover primary flows\n- [x] Feature meets measurable outcomes defined in Success Criteria\n- [x] No implementation details leak into specification\n\n## Notes\n\n- 검토 완료(2025-12-16).\n'@ | Set-Content -Path C:\\Repo\\SmugglerTPSServer\\specs\\001-udp-flatbuffer-commands\\checklists\\requirements.md"], decision="allow")
prefix_rule(pattern=["C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe", "-Command", "(Get-Content -Raw C:\\Repo\\SmugglerTPSServer\\specs\\001-udp-flatbuffer-commands\\spec.md) -replace '\\[2\\]','2' | Set-Content -Path C:\\Repo\\SmugglerTPSServer\\specs\\001-udp-flatbuffer-commands\\spec.md"], decision="allow")
prefix_rule(pattern=["C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe", "-Command", "$content = @'\n@page \"/\"\n\n<PageTitle>Home</PageTitle>\n\n<div class=\"container py-4\">\n    <h1 class=\"mb-3\">서버 현황</h1>\n\n    <div class=\"card shadow-sm border-0 mb-4\">\n        <div class=\"card-body d-flex align-items-center\">\n            <div class=\"display-4 fw-bold text-primary me-3\">@currentConcurrentUsers</div>\n            <div>\n                <div class=\"fw-semibold\">현재 동시 접속자 수</div>\n                <div class=\"text-muted small\">서버 연동 준비 중</div>\n            </div>\n        </div>\n    </div>\n\n    <p class=\"text-muted\">실시간 서버 데이터 연동 후 자동 갱신될 예정입니다.</p>\n</div>\n\n@code {\n    private int currentConcurrentUsers = 0;\n}\n'@;\nSet-Content -Path \"TPSManager/Components/Pages/Home.razor\" -Value $content -Encoding utf8"], decision="allow")
prefix_rule(pattern=["C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe", "-Command", "$content = @'\n@page \"/\"\n\n<PageTitle>Home</PageTitle>\n\n<div class=\"container py-4\">\n    <h1 class=\"mb-3\">서버 현황</h1>\n\n    <div class=\"card shadow-sm border-0 mb-3\">\n        <div class=\"card-body d-flex align-items-center\">\n            <div class=\"display-4 fw-bold text-primary me-3\">@currentConcurrentUsers</div>\n            <div>\n                <div class=\"fw-semibold\">현재 동시 접속자 수</div>\n                <div class=\"text-muted small\">서버 연동 준비 중</div>\n            </div>\n        </div>\n    </div>\n\n    <div class=\"card shadow-sm border-0 mb-4\">\n        <div class=\"card-body d-flex align-items-center\">\n            <div class=\"display-4 fw-bold text-success me-3\">@currentRoomCount</div>\n            <div>\n                <div class=\"fw-semibold\">현재 생성된 방 개수</div>\n                <div class=\"text-muted small\">서버 연동 준비 중</div>\n            </div>\n        </div>\n    </div>\n\n    <p class=\"text-muted\">실시간 서버 데이터 연동 후 자동 갱신될 예정입니다.</p>\n</div>\n\n@code {\n    private int currentConcurrentUsers = 0;\n    private int currentRoomCount = 0;\n}\n'@;\nSet-Content -Path \"TPSManager/Components/Pages/Home.razor\" -Value $content -Encoding utf8"], decision="allow")
prefix_rule(pattern=["C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe", "-Command", ".specify/scripts/powershell/setup-plan.ps1 -Json"], decision="allow")
prefix_rule(pattern=["C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe", "-Command", "$plan = @'\n# Implementation Plan: 001-udp-flatbuffer-commands\n\n**Branch**: `001-udp-flatbuffer-commands` | **Date**: 2025-12-18 | **Spec**: C:\\Repo\\SmugglerTPSServer\\specs\\001-udp-flatbuffer-commands\\spec.md  \n**Input**: Feature specification from `/specs/001-udp-flatbuffer-commands/spec.md`\n\n## Summary\n\nBlazor UI에서 기존 SmugglerLib Flatbuffer 프로토콜을 이용해 UDP 서버로 명령을 송신하고 응답을 수신하는 브리지 기능을 추가한다. 서버 측은 UDP 소켓/ENet 클라이언트를 통해 명령을 직렬화·역직렬화하고, UI는 결과/에러를 실시간으로 표시하며 모든 요청/응답을 PostgreSQL에 기록한다. 성능 목표는 p95 2초 이내 응답, 50 rps 지속 처리, 로그 100% 보존이다.\n\n## Technical Context\n\n**Language/Version**: C# / .NET 8.0  \n**Primary Dependencies**: ASP.NET Core (서버), Blazor WebAssembly (클라이언트), SmugglerLib.Generated.Protocol (Flatbuffer), System.Net.Sockets/ENet(UDP), Dapper + Npgsql (DB)  \n**Storage**: PostgreSQL (명령/응답 로그, 메타데이터)  \n**Testing**: `dotnet test` (서버/클라이언트/SmugglerLib 단위·통합 테스트)  \n**Target Platform**: Windows/Linux 서버 + WASM 클라이언트  \n**Project Type**: 웹(ASP.NET Core API + Blazor WASM) + 공유 라이브러리(SmugglerLib)  \n**Performance Goals**: p95 ≤ 2초(명령 왕복), 50 rps 이상 지속, DB 기록 누락 0건  \n**Constraints**: Flatbuffer 스키마 준수, UDP 무연결 특성 대응(재시도/타임아웃), 비밀키/엔드포인트 환경설정 분리  \n**Scale/Scope**: 운영자용 도구, 동시 수십 명 UI 사용 + 백엔드 50 rps 수준\n\n## Constitution Check\n\n- 코드 원칙: 공용 로직은 `../SmugglerLib` 활용 및 후방 호환성 유지, 보안/문서화 요구 준수.\n- 테스트: dotnet test 가능 상태 유지, UDP/Flatbuffer/계약 테스트 계획 포함.\n- 퍼포먼스: UDP 왕복 p95 2초, 50rps 목표에 맞춰 측정·로그 기준 설정.\n- 보안: 비밀값은 user secrets/env, 최소 권한 원칙.\n- 문서: plan/spec/research/data-model/quickstart/contracts 산출물과 로그 가시성 확보.\n\n## Project Structure\n\n```text\nspecs/001-udp-flatbuffer-commands/\n|-- plan.md              # 구현 계획\n|-- research.md          # 기술 선택/불확실성 해소 결과\n|-- data-model.md        # 엔터티/상태/검증 정의\n|-- quickstart.md        # 실행/개발 가이드\n|-- contracts/           # API/프로토콜 계약(OpenAPI 등)\n|-- tasks.md             # Phase 2 산출물 (추후)\n`-- spec.md              # 기능 스펙\n\nTPSManager/              # ASP.NET Core 서버 (UDP 브리지 API, DB 로깅)\nTPSManager.Client/       # Blazor WASM 클라이언트 (명령 전송/응답 표시)\nSmugglerLib/             # Flatbuffer/ENet/공유 헬퍼, 프로토콜 정의\n```\n\n**Structure Decision**: 서버(ASP.NET Core) + 클라이언트(Blazor WASM) + 공유 라이브러리(SmugglerLib) 구조를 유지하고, 문서 산출물은 `specs/001-udp-flatbuffer-commands/` 아래에 배치한다. API 계약은 `contracts/`에 OpenAPI로 정의하며 DB 스키마/로그 모델은 `data-model.md`에 정리한다.\n\n## Complexity Tracking\n\n(필요 시 위반 사항을 여기에 기록)\n'@;\nSet-Content -Path \"C:\\Repo\\SmugglerTPSServer\\specs\\001-udp-flatbuffer-commands\\plan.md\" -Value $plan -Encoding utf8"], decision="allow")
prefix_rule(pattern=["C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe", "-Command", "$research = @'\n# Research Notes - 001-udp-flatbuffer-commands\n\n## UDP 클라이언트 스택\n- Decision: System.Net.Sockets 기반 `UdpClient` + CancellationToken + 타임아웃/재시도 래퍼를 서버 백그라운드 서비스에서 제공한다.\n- Rationale: .NET 8에서 기본 제공, 추가 네이티브 의존성 없이 50rps 수준 처리 가능하며 SmugglerLib와 함께 Flatbuffer 버퍼를 그대로 송신할 수 있다.\n- Alternatives considered: ENet 클라이언트(추가 래퍼 필요, 배포 복잡), Raw Socket 핸들링(에러/타임아웃 처리 중복 코드 증가).\n\n## Flatbuffer 직렬화/역직렬화 전략\n- Decision: `SmugglerLib/Generated/Protocol`의 Flatbuffer 타입을 사용해 명령/응답을 빌드하고 `ByteBuffer`를 그대로 UDP 페이로드로 사용한다.\n- Rationale: 스펙에서 제시한 표준 스키마를 준수해 C++ UDP 서버와 호환성을 보장하고, 복호화 오류 시 스키마 버전과 필드 누락을 바로 감지할 수 있다.\n- Alternatives considered: 수동 바이트 배열 매핑(버전 불일치 위험), JSON/Proto 변환(스펙 불일치, 추가 비용).\n\n## 신뢰성/타임아웃 정책\n- Decision: 요청당 `CorrelationId`를 포함하고 p95 2초 목표에 맞춰 3회 이하 재시도(예: 500ms/1s/1.5s backoff) 후 실패 기록을 남긴다.\n- Rationale: UDP 무연결 특성 보완, SLA(2초) 준수, 로그 완전성(FR-005/SC-003) 확보.\n- Alternatives considered: 단일 송신 후 대기(패킷 손실 시 사용자 경험 악화), 무제한 재시도(폭주 및 지연 증가).\n\n## 로깅/저장소\n- Decision: PostgreSQL에 `command_logs` 테이블을 두고 Dapper로 요청/응답 원본, 상태, 타이밍을 기록하며 UI 조회 API를 제공한다.\n- Rationale: 스펙이 PostgreSQL+Dapper를 명시, 가벼운 매핑으로 50rps 로깅에도 부담이 적다.\n- Alternatives considered: EF Core(마이그레이션/트래킹 오버헤드), 파일 로깅(검색/집계 곤란, 보존 정책 관리 어려움).\n\n## 구성/비밀 관리\n- Decision: UDP 엔드포인트, 포트, 타임아웃, DB 연결 문자열을 `appsettings.{Environment}.json` + user secrets/env 변수에서 주입한다.\n- Rationale: 보안 원칙 준수(Constitution), 환경별 조정 용이, 테스트/운영에서 설정 변경만으로 튜닝 가능.\n- Alternatives considered: 코드 상수 하드코딩(보안/배포 리스크), CLI 인자 기반만 사용(서비스/호스팅 시 번거로움).\n'@;\nSet-Content -Path \"C:\\Repo\\SmugglerTPSServer\\specs\\001-udp-flatbuffer-commands\\research.md\" -Value $research -Encoding utf8"], decision="allow")
prefix_rule(pattern=["C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe", "-Command", "$dataModel = @'\n# Data Model - 001-udp-flatbuffer-commands\n\n## CommandPacket (Flatbuffer)\n- Fields: CommandType(enum), Payload(typed table from SmugglerLib.Generated.Protocol), CorrelationId(Guid), Timestamp(long, unix ms)\n- Relationships: Sent via UDP to remote server; response maps back via CorrelationId.\n- Validation: CommandType must be known; Payload must match schema version; CorrelationId non-empty; Timestamp within clock skew window (±5m) for observability.\n\n## CommandDispatch (Server record)\n- Fields: Id(Guid), CommandType, RequestBytes(byte[]), SentAt(utc), Attempt(int), TimeoutMs(int), Status(pending/sent/failed/succeeded), ResponseId(Guid?)\n- Relationships: Links to CommandResult via ResponseId/CorrelationId; one-to-many attempts per user action.\n- Validation: TimeoutMs > 0 and ≤ 2000 (p95 목표), Attempt >= 1, RequestBytes length > 0.\n\n## CommandResult (Server record)\n- Fields: Id(Guid), CorrelationId(Guid), ResponseBytes(byte[]), ReceivedAt(utc), DurationMs(int), Outcome(success/fault/timeout), ErrorCode(string?), ErrorMessage(string?)\n- Relationships: Tied to CommandDispatch by CorrelationId; surfaced to UI and persisted to DB.\n- Validation: DurationMs >= 0; ResponseBytes length > 0 when Outcome=success; ErrorMessage required when Outcome != success.\n\n## DB Tables (PostgreSQL)\n- `command_logs`\n  - Columns: id(uuid, pk), correlation_id(uuid, unique), command_type(text), request_bytes(bytea), response_bytes(bytea null), outcome(text), attempt int, timeout_ms int, sent_at timestamptz, received_at timestamptz null, duration_ms int null, error_code text null, error_message text null\n  - Indexes: correlation_id unique, sent_at, outcome\n  - Constraints: timeout_ms > 0 and <= 2000; attempt >= 1\n- `command_events` (optional fine-grain audit)\n  - Columns: id(uuid pk), correlation_id(uuid), event_type(text: dispatched|retry|timeout|received|failed), payload jsonb, occurred_at timestamptz\n  - Indexes: correlation_id, occurred_at\n\n## UI View Models\n- CommandRequestView: CommandType, Parameters(form bound), TimeoutMs(default 2000), Retries(default 2)\n- CommandResponseView: CorrelationId, Outcome, DurationMs, ResponsePreview(string), ErrorMessage, ReceivedAt\n- HistoryRow: CommandType, Outcome, SentAt, DurationMs, Attempts\n\n## State Transitions\n1. pending -> sent (UDP 송신 성공)\n2. sent -> succeeded (응답 수신) | sent -> failed (소켓 오류) | sent -> timeout (타임아웃 초과)\n3. failed/timeout + retries 남음 -> pending(다음 attempt)\n4. succeeded/failed/timeout -> logged (DB 기록 완료)\n'@;\nSet-Content -Path \"C:\\Repo\\SmugglerTPSServer\\specs\\001-udp-flatbuffer-commands\\data-model.md\" -Value $dataModel -Encoding utf8"], decision="allow")
prefix_rule(pattern=["C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe", "-Command", "$qs = @'\n# Quickstart - 001-udp-flatbuffer-commands\n\n## Prerequisites\n- .NET 8 SDK 설치 확인 (`dotnet --list-sdks`)\n- PostgreSQL 인스턴스 및 연결 문자열 준비 (user secrets/env로 주입)\n- UDP 대상 서버 엔드포인트/포트/Flatbuffer 프로토콜 버전 확인\n\n## 설정\n1) 서버 설정 (`TPSManager/appsettings.Development.json` 또는 환경변수)\n- `Udp:Host`, `Udp:Port`, `Udp:SendTimeoutMs`, `Udp:ReceiveTimeoutMs`, `Udp:MaxRetries`\n- `ConnectionStrings:CommandDb` (PostgreSQL)\n- `Logging` 레벨: UDP 전송/응답 카테고리 Information 이상\n\n2) User Secrets (개발):\n```ps1\ncd C:\\Repo\\SmugglerTPSServer\\TPSManager\ndotnet user-secrets set \"ConnectionStrings:CommandDb\" \"Host=...;Username=...;Password=...;Database=...\"\n```\n\n## 빌드\n```ps1\ncd C:\\Repo\\SmugglerTPSServer\n dotnet restore SmugglerServer.sln\n dotnet build TPSManager/TPSManager.csproj\n dotnet build TPSManager.Client/TPSManager.Client.csproj\n```\n\n## 실행\n- 서버: `dotnet run --project TPSManager/TPSManager.csproj`\n- 클라이언트(WASM dev): `dotnet run --project TPSManager.Client/TPSManager.Client.csproj`\n- 필요 시 UDP 대상 서버/포트는 `appsettings.*`로 조정 후 재시작\n\n## 테스트\n```ps1\ncd C:\\Repo\\SmugglerTPSServer\n dotnet test\n```\n- UDP 전송/Flatbuffer 역직렬화 테스트 케이스 추가 후 `dotnet test`로 확인\n- p95 2초 목표를 위한 로드 테스트는 추후 시나리오/스크립트로 측정\n\n## 개발 흐름\n1) SmugglerLib.Generated.Protocol 스키마 확인 후 필요한 명령 UI/DTO 정의\n2) 서버에 UDP 브리지 서비스/컨트롤러 추가, DB 로깅 파이프라인 구현\n3) 클라이언트 페이지에서 명령 전송 폼 + 실시간 응답/로그 리스트 표시\n4) 로깅/모니터링: DB에 저장된 결과 조회 API 연결 및 UI 필터 추가\n'@;\nSet-Content -Path \"C:\\Repo\\SmugglerTPSServer\\specs\\001-udp-flatbuffer-commands\\quickstart.md\" -Value $qs -Encoding utf8"], decision="allow")
prefix_rule(pattern=["C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe", "-Command", "New-Item -ItemType Directory -Path \"C:\\Repo\\SmugglerTPSServer\\specs\\001-udp-flatbuffer-commands\\contracts\" -Force"], decision="allow")
prefix_rule(pattern=["C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe", "-Command", "$openapi = @'\nopenapi: 3.0.3\ninfo:\n  title: UDP Flatbuffer Command Bridge API\n  version: 0.1.0\nservers:\n  - url: http://localhost:5000\npaths:\n  /api/udp-commands/dispatch:\n    post:\n      summary: Dispatch a Flatbuffer command via UDP\n      operationId: dispatchCommand\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              $ref: '#/components/schemas/DispatchRequest'\n      responses:\n        '202':\n          description: Accepted\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/DispatchAccepted'\n        '400':\n          description: Invalid payload\n        '500':\n          description: Dispatch failed\n  /api/udp-commands/{correlationId}:\n    get:\n      summary: Get status/result for a dispatched command\n      operationId: getCommandStatus\n      parameters:\n        - in: path\n          name: correlationId\n          required: true\n          schema:\n            type: string\n            format: uuid\n      responses:\n        '200':\n          description: Current status/result\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/CommandStatus'\n        '404':\n          description: Not found\n  /api/udp-commands/logs:\n    get:\n      summary: Query command logs\n      operationId: queryCommandLogs\n      parameters:\n        - in: query\n          name: commandType\n          schema:\n            type: string\n        - in: query\n          name: outcome\n          schema:\n            type: string\n            enum: [pending, sent, succeeded, failed, timeout]\n        - in: query\n          name: from\n          schema:\n            type: string\n            format: date-time\n        - in: query\n          name: to\n          schema:\n            type: string\n            format: date-time\n        - in: query\n          name: page\n          schema:\n            type: integer\n            minimum: 1\n            default: 1\n        - in: query\n          name: pageSize\n          schema:\n            type: integer\n            minimum: 1\n            maximum: 200\n            default: 50\n      responses:\n        '200':\n          description: Paged command log entries\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/CommandLogPage'\ncomponents:\n  schemas:\n    DispatchRequest:\n      type: object\n      required: [commandType, payloadBase64]\n      properties:\n        commandType:\n          type: string\n        payloadBase64:\n          type: string\n          description: Base64-encoded Flatbuffer payload from SmugglerLib.Generated.Protocol\n        timeoutMs:\n          type: integer\n          minimum: 1\n          maximum: 2000\n          default: 2000\n        maxRetries:\n          type: integer\n          minimum: 0\n          maximum: 5\n          default: 2\n    DispatchAccepted:\n      type: object\n      required: [correlationId, status]\n      properties:\n        correlationId:\n          type: string\n          format: uuid\n        status:\n          type: string\n          enum: [pending, sent]\n    CommandStatus:\n      type: object\n      required: [correlationId, status]\n      properties:\n        correlationId:\n          type: string\n          format: uuid\n        status:\n          type: string\n          enum: [pending, sent, succeeded, failed, timeout]\n        outcome:\n          type: string\n          enum: [success, fault, timeout]\n          nullable: true\n        durationMs:\n          type: integer\n          nullable: true\n        responseBase64:\n          type: string\n          nullable: true\n          description: Base64-encoded Flatbuffer response payload\n        errorCode:\n          type: string\n          nullable: true\n        errorMessage:\n          type: string\n          nullable: true\n        receivedAt:\n          type: string\n          format: date-time\n          nullable: true\n    CommandLog:\n      type: object\n      properties:\n        correlationId:\n          type: string\n          format: uuid\n        commandType:\n          type: string\n        outcome:\n          type: string\n        sentAt:\n          type: string\n          format: date-time\n        receivedAt:\n          type: string\n          format: date-time\n          nullable: true\n        durationMs:\n          type: integer\n          nullable: true\n        attempts:\n          type: integer\n        errorMessage:\n          type: string\n          nullable: true\n    CommandLogPage:\n      type: object\n      properties:\n        total:\n          type: integer\n        page:\n          type: integer\n        pageSize:\n          type: integer\n        items:\n          type: array\n          items:\n            $ref: '#/components/schemas/CommandLog'\n'@;\nSet-Content -Path \"C:\\Repo\\SmugglerTPSServer\\specs\\001-udp-flatbuffer-commands\\contracts\\udp-commands.openapi.yaml\" -Value $openapi -Encoding utf8"], decision="allow")
prefix_rule(pattern=["C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe", "-Command", ".specify/scripts/powershell/update-agent-context.ps1 -AgentType codex"], decision="allow")
