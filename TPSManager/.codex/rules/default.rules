prefix_rule(pattern=["C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe", "-Command", "git fetch --all --prune"], decision="allow")
prefix_rule(pattern=["C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe", "-Command", ".specify/scripts/powershell/create-new-feature.ps1 -Json -Number 1 -ShortName \"udp-flatbuffer-commands\" \"블레이저 웹을 통해서 UDP 서버와 Flatbuffer로 통신하여 패킷을 통해 커맨드 전송이 되는 구성을 만들어야한다. 패킷은 C:RepoSmugglerTPSServerSmugglerLibGeneratedProtocol에 이미 구성되어 있다. 패킷 추가는 개발자가 할 예정. flatbuffer를 통해 c++ udp 서버와 통신이 되면 된다. 이후 DB는 postgrsql과 통신할것이다. 그래서 dapper를 통한 통신이 진행될것\""], decision="allow")
prefix_rule(pattern=["C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe", "-Command", "@'\n# Feature Specification: Blazor UDP Flatbuffer Command Bridge\n\n**Feature Branch**: `001-udp-flatbuffer-commands`  \n**Created**: 2025-12-16  \n**Status**: Draft  \n**Input**: User description: \"블레이저 웹을 통해서 UDP 서버와 Flatbuffer로 통신하여 패킷을 통해 커맨드 전송이 되는 구성을 만들어야한다. 패킷은 C:RepoSmugglerTPSServerSmugglerLibGeneratedProtocol에 이미 구성되어 있다. 패킷 추가는 개발자가 할 예정. flatbuffer를 통해 c++ udp 서버와 통신이 되면 된다. 이후 DB는 postgrsql과 통신할것이다. 그래서 dapper를 통한 통신이 진행될것\"\n\n## User Scenarios & Testing *(mandatory)*\n\n### User Story 1 - 운영자가 UDP 명령 전송 (Priority: P1)\n\n운영자는 Blazor 웹 도구에서 기존 Flatbuffer 패킷 정의를 선택해 UDP 서버로 명령을 전송한다.\n\n**Why this priority**: 핵심 기능으로, 관리 명령 송신이 가능해야 다른 기능이 의미를 갖는다.\n\n**Independent Test**: 웹 UI에서 패킷 선택/입력 후 전송 시 서버 응답을 받으면 완료 상태로 표시되는지 확인한다.\n\n**Acceptance Scenarios**:\n\n1. **Given** 운영자가 인증된 상태로 명령 유형과 파라미터를 선택하고, **When** 전송을 요청하면, **Then** Flatbuffer 형식으로 패킷이 조립되어 UDP 서버로 전송된다.\n2. **Given** 서버가 응답 패킷을 반환할 때, **When** 웹 도구가 응답을 수신하면, **Then** 성공 여부와 서버 메시지를 UI에 표시한다.\n\n---\n\n### User Story 2 - 전송 상태 가시화 및 재시도 (Priority: P2)\n\n운영자는 패킷 전송 결과(성공/타임아웃/실패)와 재시도 옵션을 확인할 수 있다.\n\n**Why this priority**: UDP 특성상 손실 가능성이 있어 운영자가 즉시 상태를 파악하고 조치해야 한다.\n\n**Independent Test**: 서버 응답 지연/손실을 시뮬레이션하여 UI가 타임아웃을 표시하고 재시도 동작을 수행하는지 확인한다.\n\n**Acceptance Scenarios**:\n\n1. **Given** 서버 응답이 없을 때, **When** 타임아웃이 발생하면, **Then** UI가 실패 사유를 표시하고 재시도 버튼을 제공한다.\n2. **Given** 재시도를 수행할 때, **When** 서버가 성공 응답을 반환하면, **Then** 최종 성공 상태로 업데이트하고 이력을 남긴다.\n\n---\n\n### User Story 3 - 명령/응답 이력 기록 (Priority: P3)\n\n운영자는 명령 전송·응답 이력이 DB에 저장되어 이후 감사/분석에 활용할 수 있다.\n\n**Why this priority**: 운영 추적성과 회귀 분석을 위해 이력이 필요하다.\n\n**Independent Test**: 명령 전송 후 DB에서 해당 요청/응답 기록이 생성되고, UI나 보고서에서 조회 가능함을 확인한다.\n\n**Acceptance Scenarios**:\n\n1. **Given** 명령이 성공/실패로 종료되었을 때, **When** 기록 작업이 수행되면, **Then** 요청자, 명령 유형, 파라미터, 응답 코드/메시지, 타임스탬프가 DB에 저장된다.\n2. **Given** 저장된 이력이 있을 때, **When** 운영자가 검색 조건으로 조회하면, **Then** 해당 결과가 정렬·필터링되어 표시된다.\n\n---\n\n### Edge Cases\n\n- UDP 패킷 손실/지연으로 응답이 없는 경우 타임아웃 및 재시도 처리.\n- Flatbuffer 스키마 버전 불일치나 알 수 없는 패킷 유형을 수신할 때 오류 표시 및 로깅.\n- DB 연결 실패 시 전송 자체는 지속하되, 이력 적재 실패를 사용자에게 알리고 재시도 경로를 제공.\n- 동일 명령 반복 전송 시 중복 처리(서버 idempotency 여부)에 따라 재전송 정책을 명시적으로 안내.\n\n## Requirements *(mandatory)*\n\n### Functional Requirements\n\n- **FR-001**: 시스템은 기존 `SmugglerLib/Generated/Protocol`에 정의된 Flatbuffer 패킷 스키마를 사용해 UI 입력을 검증·조립하여 UDP 전송에 적합한 바이트 페이로드를 생성해야 한다.\n- **FR-002**: 시스템은 구성된 UDP 엔드포인트로 패킷을 전송하고, 응답 수신 시 성공/실패 코드와 메시지를 UI에 표준화된 상태로 반영해야 한다.\n- **FR-003**: 시스템은 응답이 없을 때 p95 기준 [2]초 이내에 타임아웃을 표시하고, 최소 한 번 이상의 재시도 옵션을 제공해야 한다.\n- **FR-004**: 시스템은 전송/응답 상태를 실시간으로 표시하며, 운영자가 재시도·중단을 선택할 수 있는 UI를 제공해야 한다.\n- **FR-005**: 시스템은 모든 전송 요청에 대해 고유 식별자, 사용자, 명령 유형, 파라미터, 전송 시각, 응답 시각/결과를 기록하고 조회·필터링 기능을 제공해야 한다.\n- **FR-006**: 시스템은 DB 연결 정보, UDP 대상 주소/포트, Flatbuffer 스키마 버전을 환경 설정으로 받아들이며, 설정 변경 시 앱 재시작 없이 반영 여부를 명확히 안내해야 한다.\n- **FR-007**: 시스템은 인증된 운영자만 명령을 전송·조회할 수 있도록 기존 권한 모델을 적용하고, 모든 실패/예외를 로깅해야 한다.\n- **FR-008**: 시스템은 스키마 업데이트(새 패킷 추가 등) 시 최신 스키마를 불러와 UI 선택지와 검증 로직을 일관되게 반영해야 한다.\n\n### Key Entities *(include if feature involves data)*\n\n- **CommandPacket**: 전송할 명령 유형과 파라미터를 캡슐화한 구조(Flatbuffer 정의 기반).\n- **CommandDispatch**: 전송 요청 메타데이터(요청자, 목적지, 시각, 상태, 재시도 횟수).\n- **CommandResult**: 응답 코드/메시지, 수신 시각, 오류 정보, 연계된 Dispatch 식별자.\n\n## 품질 기준 *(mandatory)*\n\n- **Testing**: 단위(패킷 조립/검증), 통합(UDP 송수신 시나리오), 계약(Flatbuffer 스키마 호환) 테스트를 작성하고 `dotnet test`가 재현 가능하게 통과해야 한다.\n- **Performance**: 운영자가 전송 버튼을 누른 후 95% 요청이 2초 이내 상태 업데이트를 보며, 50rps 동시 요청에서도 지연 목표를 유지한다는 계획과 측정 방법을 명시한다.\n- **Security**: 비밀·엔드포인트는 환경 설정으로 관리하고, 입력 검증·권한 확인을 거쳐서만 전송한다. 모든 에러·거부 이벤트는 감사 로그에 남긴다.\n- **Documentation**: 스펙/플랜/태스크와 운영 로그에 전송 흐름, 재시도/타임아웃 정책, 의존 스키마 버전, 설정 방법을 동일 릴리스에 기록한다.\n- **Quality Bar**: SmugglerLib 스키마와 동기화 상태를 유지하고, 린트/정적 분석 경고 없이 빌드되며, 리뷰 시 테스트/성능/보안 영향 요약을 포함한다.\n\n## Success Criteria *(mandatory)*\n\n### Measurable Outcomes\n\n- **SC-001**: 운영자가 정의된 명령을 전송했을 때 95% 이상에서 2초 이내에 성공/실패 상태가 UI에 표시된다.\n- **SC-002**: UDP 응답 손실 상황에서 최소 1회 재시도 후 90% 이상이 성공 상태로 전환된다(서버 가용 시 기준).\n- **SC-003**: 모든 전송 건에 대해 요청자, 명령 유형, 결과가 DB 조회에서 100% 확인 가능하다.\n- **SC-004**: 사용자 만족도 조사 또는 피드백에서 “명령 전송 흐름이 명확하다” 항목에 80% 이상 긍정 응답을 얻는다.\n'@ | Set-Content -Path C:\\Repo\\SmugglerTPSServer\\specs\\001-udp-flatbuffer-commands\\spec.md"], decision="allow")
prefix_rule(pattern=["C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe", "-Command", "New-Item -ItemType Directory -Path C:\\Repo\\SmugglerTPSServer\\specs\\001-udp-flatbuffer-commands\\checklists -Force | Out-Null"], decision="allow")
prefix_rule(pattern=["C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe", "-Command", "@'\n# Specification Quality Checklist: Blazor UDP Flatbuffer Command Bridge\n\n**Purpose**: Validate specification completeness and quality before proceeding to planning\n**Created**: 2025-12-16\n**Feature**: spec.md\n\n## Content Quality\n\n- [x] No implementation details (languages, frameworks, APIs)\n- [x] Focused on user value and business needs\n- [x] Written for non-technical stakeholders\n- [x] All mandatory sections completed\n\n## Requirement Completeness\n\n- [x] No [NEEDS CLARIFICATION] markers remain\n- [x] Requirements are testable and unambiguous\n- [x] Success criteria are measurable\n- [x] Success criteria are technology-agnostic (no implementation details)\n- [x] All acceptance scenarios are defined\n- [x] Edge cases are identified\n- [x] Scope is clearly bounded\n- [x] Dependencies and assumptions identified\n\n## Feature Readiness\n\n- [x] All functional requirements have clear acceptance criteria\n- [x] User scenarios cover primary flows\n- [x] Feature meets measurable outcomes defined in Success Criteria\n- [x] No implementation details leak into specification\n\n## Notes\n\n- 검토 완료(2025-12-16).\n'@ | Set-Content -Path C:\\Repo\\SmugglerTPSServer\\specs\\001-udp-flatbuffer-commands\\checklists\\requirements.md"], decision="allow")
prefix_rule(pattern=["C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe", "-Command", "(Get-Content -Raw C:\\Repo\\SmugglerTPSServer\\specs\\001-udp-flatbuffer-commands\\spec.md) -replace '\\[2\\]','2' | Set-Content -Path C:\\Repo\\SmugglerTPSServer\\specs\\001-udp-flatbuffer-commands\\spec.md"], decision="allow")
